"use strict";!function(angular){var snugfeeds=angular.module("snug-feeds",["article","snugfeed.service.articles","ngCookies","modal","logincomponent","registercomponent","snugfeed.service.user","managefeedscomponent","snugfeed.service.feeds","newfeedcomponent","readarticlecomponent","snugfeed.service.preference","ngAnimate","toggleviewcomponent"]);snugfeeds.controller("feedsController",function($scope,$http,snugfeedArticlesService,$cookies,snugfeedUserService,snugfeedFeedsService,$timeout,preferenceService,$window){function resetLayout(){$scope.articleView?msnry&&msnry.destroy():$timeout(function(){msnry=new Masonry("#article-contain",{itemSelector:".mason",columnWidth:".mason-sizer",percentPosition:!0,gutter:".mason-gutter"}),imagesLoaded($("#article-contain")).on("progress",function(){msnry.layout()})},200)}function getSavedArticles(){snugfeedArticlesService.getSavedArticles().then(function(resp){$scope.savedArticles=resp.data})}function getFeedsIds(){var feeds=$scope.user.feeds?$scope.user.feeds:$scope.activeFeeds;return feeds.map(function(i){return i.id})}function getUserStatus(){snugfeedUserService.getUserStatus().then(function(data){data.data.user&&($scope.user=data.data.user,$scope.activeFeeds=$scope.user.feeds,$scope.user.initials=snug.generateAvatarInitials($scope.user.name),getSavedArticles()),$scope.getArticles(!1)})}function handleFeedUpdate(feeds){snugfeedFeedsService.updateFeeds(feeds).then(function(data){getUserStatus(),$("#feedsModal").modal("hide"),$scope.$broadcast("reload feeds")})}function incoming(text){$scope.incoming=!0,$scope.noti.text=text,setTimeout(function(){$scope.incoming=!1,$scope.$apply()},3e3),$scope.$apply()}$scope.loading=!0,$scope.feeds=[],$scope.lastFeedID=43,$scope.articleFilter=!1,$scope.loginModal={activeModel:"login"},$scope.manageFeedsModal={saveFeeds:function(feeds){handleFeedUpdate(feeds)}},$scope.user=!1,$scope.activeFeeds=$cookies.getObject("feeds"),$scope.savedArticles={},$scope.showSaved=!1,$scope.articleView=preferenceService.get("articleView"),$scope.articleToRead={},$scope.showSettingsMenu=!1,$scope.showNotice=preferenceService.get("hideNotice"),$scope.emptyFeeds=!1,$scope.noti={text:"Alert"},$scope.showMobileFeeds=!1;var msnry=!1;$scope.getArticles=function(page){page||($scope.feeds=[],$window.scrollTo(0,0)),page=!!page&&$scope.lastFeedID;var ids=$scope.articleFilter?[$scope.articleFilter]:getFeedsIds();ids.length>0?snugfeedArticlesService.getArticles(page,ids).then(function(data){data.data.length>0&&($scope.feeds=$scope.feeds.concat(data.data),$scope.lastFeedID=data.data[data.data.length-1].id,resetLayout()),$scope.loading=!1,$scope.emptyFeeds=!1}):($scope.emptyFeeds=!0,$scope.loading=!1)},$scope.filterArticles=function(id){$scope.articleFilter=id,$scope.getArticles(!1),$scope.showSaved=!1,$scope.showMobileFeeds=!1},$scope.showLoginModal=function(){$("#loginModal").modal("show"),$scope.loginModal.activeModel="login"},$scope.showNewFeedModal=function(){$("#newFeedModal").modal("show")},$scope.showMangeFeedsModal=function(){$("#feedsModal").modal("show")},$scope.showSavedArticles=function(){$scope.feeds=$scope.savedArticles,$scope.showSaved=!0,resetLayout()},$scope.clearClick=function(){$scope.showSettingsMenu=!1},$scope.toggleSettingsMenu=function($event){$event&&$event.stopPropagation(),$scope.showSettingsMenu=!$scope.showSettingsMenu},$scope.toggleFeedsMobile=function(){$scope.showMobileFeeds=!$scope.showMobileFeeds},getUserStatus(),$scope.toggleView=function(toggle){$scope.articleView=toggle,resetLayout(),preferenceService.set("articleView",toggle)},$scope.$on("article saved",function(c,v){$scope.savedArticles.push(v),incoming("Article Saved!")}),$scope.$on("article deleted",function(c,article){var arr=$scope.savedArticles;arr=_.filter(arr,function(item){return item.id!==article.id}),$scope.savedArticles=arr,$scope.showSavedArticles(),incoming("Article Deleted!")}),$scope.$on("login success",function(){getUserStatus(),$scope.$broadcast("reload manage feeds"),$("#loginModal").modal("hide")}),$scope.$on("register success",function(){$scope.loginModal.activeModel="login"}),$scope.$on("read article",function(c,value){$scope.articleToRead=value,$timeout(function(){$("#readArticleModal").modal("show")},100)}),$scope.hideNotice=function(){$scope.showNotice=!0,preferenceService.set("hideNotice",!0)},$scope.$on("add feed success",function(){incoming("New Feed Added. We are working on adding the latest articles now!"),$("#newFeedModal").modal("hide"),getUserStatus(),$scope.$broadcast("reload manage feeds")})}).directive("topScroll",function($anchorScroll,$window){return{link:function(scope,element,attrs){$($window).on("scroll",function(){$window.scrollY>75&&window.innerWidth>723?$(element).css({top:"-75px"}):$(element).css({top:0})})},restrict:"A"}})}(angular),function(angular){angular.module("article",["ngSanitize","snugfeed.service.articles"]).directive("article",function($sce,snugfeedArticlesService,$timeout){function link(scope,element,attrs){function charLimit(content){return content?(content=content.split("<br>")[0],content=content.split("</p>")[0],content.length>500&&(content=content.substring(0,500)+"..."),content):""}function getFavicon(id){if(scope.$parent.activeFeeds&&id){var arr=_.find(scope.$parent.activeFeeds,function(feed){return feed.id==id});return arr.favicon_url}return""}scope.toTrustedHTML=function(html){return $sce.trustAsHtml(charLimit(html))},scope.saveArticle=function(article){snugfeedArticlesService.saveArticle(article.id).then(function(){$timeout(function(){scope.$emit("article saved",article)})})},scope.deleteArticle=function(article){snugfeedArticlesService.deleteArticle(article.id).then(function(){$timeout(function(){scope.$emit("article deleted",article)})})},scope.readMore=function(article){scope.$emit("read article",article)},scope.parseDate=function(date){return"Added "+snug.timePassed(date)},scope.favicon=getFavicon(scope.article.feed_id)}return{link:link,restrict:"E",scope:{article:"=article",view:"=view",showSaved:"=showsaved"},template:'<div class="actions"><i ng-click="saveArticle(article)" class="save icon pointer" ng-if="!showSaved"></i><i ng-click="deleteArticle(article)" class="trash outline icon pointer" ng-if="showSaved"></i></div><div class="icon"><img ng-src="{{favicon}}"></div><h2 class="ui header pointer" ng-click="readMore(article)">{{article.article_title}}</h2><p ng-bind-html="parseDate(article.created_at)"></p><p ng-if="article.article_img && view"><img ng-src="{{article.article_img}}"></p><p ng-bind-html="toTrustedHTML(article.article_description)" ng-if="view"></p><p ng-if="view"><a href="#" ng-click="readMore(article)">Read More</a></p>'}})}(angular),function(angular){function newFeedController($scope,$element,$attrs,snugfeedFeedsService,$timeout){function init(){snugfeedFeedsService.getFeeds().then(function(resp){$scope.values=resp.data.data})}$scope.submit=function(){var feed=$scope.selected,dataObj={};dataObj=snug.isInt(feed)?{feed_id:feed}:{feed_url:feed},$scope.loading=!0,$scope.checking=!0,$scope.message={top:"Just on second",bottom:"Checking if feed is valid..."},$scope.negative=!1,snugfeedFeedsService.addFeed(dataObj).then(function(resp){$scope.loading=!1;var r=resp.data;"success"==r.status?($scope.newFeed="",$scope.message.top="Success!",$scope.message.bottom="",$timeout(function(){$scope.$emit("add feed success")}),$timeout(function(){$scope.message={top:"Just on second",bottom:"Checking if feed is valid..."},$scope.checking=!1},1e3)):"feed already added"==r.status?($scope.negative=!0,$scope.message.top="Feed has already been added.",$scope.message.bottom=""):($scope.negative=!0,$scope.message.top="Sorry",$scope.message.bottom="This feed is invalid")})},$scope.allowSubmit=!1,$scope.loading=!1,$scope.checking=!1,$scope.message={},$scope.selected="",$scope.$watch("selected",function(newValue){newValue.length>3&&snugfeedFeedsService.searchForFeed(newValue).then(function(data){$scope.values=_.union($scope.values,data.data)})}),init()}angular.module("newfeedcomponent",["snugfeed.service.feeds","dropdown"]).component("newfeedcomponent",{controller:newFeedController,template:'<div class="ui icon message" ng-show="checking" ng-class="{\'negative\': negative}"><i class="notched circle loading icon" ng-show="loading"></i><div class="content"><div class="header">{{message.top}}</div><p>{{message.bottom}}</p></div></div><dropdowncomponent values="values" selected="selected"></dropdowncomponent><button class="ui green button" type="submit" ng-click="submit()">Add Feed</button>'})}(angular),function(angular){angular.module("snugfeed.service.articles",[]).service("snugfeedArticlesService",function($http){return{getArticles:function(page,ids){var query=page?"&start="+page:"";return ids="?ids="+ids.join(),$http.get("/api/articles"+ids+query)},saveArticle:function(id){return $http.put("/api/article/"+id)},deleteArticle:function(id){return $http["delete"]("/api/article/"+id)},getArticle:function(id){return $http.get("/api/article/"+id)},getArticlesByIds:function(ids){return $http.get("/api/articles?article-ids="+ids)},getSavedArticles:function(){return $http.get("/api/article")}}})}(angular),function(angular){function readArticleController($scope,$element,$attrs,$sce){$scope.toTrustedHTML=function(html){return $sce.trustAsHtml(html)}}angular.module("readarticlecomponent",["ngSanitize"]).component("readarticlecomponent",{controller:readArticleController,bindings:{article:"="},template:'<p ng-if="$ctrl.article.article_img"><img ng-src="{{$ctrl.article.article_img}}"></p><p ng-bind-html="toTrustedHTML($ctrl.article.article_description)"></p><a target="_blank" href="{{$ctrl.article.article_link}}" class="fluid ui button" ng-if="$ctrl.article.article_link">Visit Article Website</a> '})}(angular),function(angular){angular.module("toggleviewcomponent",[]).component("toggleviewcomponent",{bindings:{change:"<"},template:'<span>Grid View</span><div class="ui slider checkbox"><input type="checkbox" name="public" ng-change="$ctrl.change(toggle)" ng-model="toggle" ng-init="toggle=articleView"><label></label></div><span>List View</span>'})}(angular),function(angular){angular.module("snugfeed.service.preference",["ngCookies"]).service("preferenceService",function($cookies){function set(preference,value){var cookie=$cookies.getObject("preferences")?$cookies.getObject("preferences"):{};cookie[preference]=value,$cookies.putObject("preferences",cookie)}function get(preference){return"undefined"!=typeof $cookies.getObject("preferences")&&$cookies.getObject("preferences")[preference]}return{set:set,get:get}})}(angular);